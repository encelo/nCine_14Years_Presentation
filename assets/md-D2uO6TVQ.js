import{_ as h}from"./slidev/CodeBlockWrapper.vue_vue_type_script_setup_true_lang-Dk2eK6Zq.js";import{b as o,o as k,w as a,g as i,C as s,e as p,m as d,v as g,x as u,D as e}from"./modules/vue-DVoBR_Gt.js";import{I as c}from"./slidev/default-hbptgzU_.js";import{u as y,f as m}from"./slidev/context-MNQvXT2D.js";import"./modules/unplugin-icons-C1_kl-kH.js";import"./index-DezL4xne.js";import"./modules/shiki-BFBYwPGf.js";const A="/nCine_14Years_Presentation/assets/Tracy_thread_pool-DiPpw94y.png",b={grid:"~ cols-2"},J={__name:"nCine.md__slidev_64",setup(D){const{$clicksContext:l,$frontmatter:n}=y();return l.setup(),(f,t)=>{const r=h;return k(),o(c,g(u(e(m)(e(n),63))),{default:a(()=>[t[3]||(t[3]=i("h2",null,"üíä 2024 - Job System (üöß WIP) (1/2)",-1)),t[4]||(t[4]=i("ul",null,[i("li",null,[s("One thread per logic core is spawned at program start ("),i("a",{href:"https://en.wikipedia.org/wiki/Thread_pool",target:"_blank"},"thread pool"),s(")")]),i("li",null,[s("Based on a lock-free "),i("a",{href:"https://en.wikipedia.org/wiki/Work_stealing",target:"_blank"},"work stealing"),s(" queue per thread (automatic load-balancing) "),i("ul",null,[i("li",null,[i("a",{href:"https://en.wikipedia.org/wiki/Non-blocking_algorithm",target:"_blank"},"Lock-free"),s(" property is achieved with Compare-And-Swap operations on atomics")])])]),i("li",null,[s("Parent/children relationship to be able to "),i("code",null,"wait()"),s(" on parent jobs")]),i("li",null,[s("As soon as a job finishes, all of its "),i("em",null,"continuations"),s(" jobs run immediately")]),i("li",null,[s("Built-in "),i("code",null,"parallelFor(dataArray, 4096, &myDataFunc, nc::CountSplitter(128))")]),i("li",null,[s("üìú Reference: Molecular Matters blog "),i("a",{href:"https://blog.molecular-matters.com/2015/08/24/job-system-2-0-lock-free-work-stealing-part-1-basics/",target:"_blank"},"articles")])],-1)),i("div",b,[i("div",null,[i("figure",null,[p(r,d({},{title:"",ranges:[]}),{default:a(()=>t[0]||(t[0]=[i("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light slidev-code",style:{"--shiki-dark":"#dbd7caee","--shiki-light":"#393a34","--shiki-dark-bg":"#121212","--shiki-light-bg":"#ffffff"}},[i("code",{class:"language-cpp"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}},"/*! A structure representing a single job")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}}," * in the multi-threaded job system")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}}," * "),i("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"\\note"),i("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}}," To avoid false sharing, the structure")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}}," * should occupy at least one cache line */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"struct"),i("span",{style:{"--shiki-dark":"#5DA994","--shiki-light":"#2E8F82"}}," Job")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"    JobFunction function"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"    Job "),i("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"*"),i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"parent "),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"="),i("span",{style:{"--shiki-dark":"#4D9375","--shiki-light":"#1E754F"}}," nullptr"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"    nctl"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"::"),i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"Atomic32 unfinishedJobs"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"    char"),i("span",{style:{"--shiki-dark":"#BD976A","--shiki-light":"#B07D48"}}," data"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"JobDataSize"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"    nctl"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"::"),i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"Atomic32 continuationCount"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"    Job "),i("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"*"),i("span",{style:{"--shiki-dark":"#BD976A","--shiki-light":"#B07D48"}},"continuations"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),i("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"JobNumContinuations"),i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"];")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"};")])])],-1)])),_:1,__:[0]},16),t[1]||(t[1]=i("figcaption",null,[s("The job system pillar: the "),i("code",null,"Job"),s(" structure")],-1))])]),t[2]||(t[2]=i("div",null,[i("figure",{class:"w-[80%]"},[i("img",{src:A,alt:"Tracy mutli-threading capture"}),i("figcaption",null,[s("Tracy capture of "),i("a",{href:"https://github.com/nCine/nCine/blob/master/tests/apptest_jobsystem.cpp"},[i("code",null,"apptest_jobsystem")]),s(" showing jobs execution distributed among worker threads")])])],-1))]),t[5]||(t[5]=i("div",{class:"absolute left-3/4 top-1/5",style:{rotate:"25deg","font-size":"small"}},[s(" ‚ö†Ô∏è GitHub links don't work as the"),i("br"),s(" code has not been pushed yet. ‚ö†Ô∏è ")],-1))]),_:1,__:[3,4,5]},16)}}};export{J as default};
